# FMEA 다이아몬드 확장 구조 가이드

**목적**: AIAG-VDA 2019 표준의 다이아몬드(피라미드) 확장 구조 상세 설명

---

## 📑 목차

1. [[!!] 기능-고장영향 인과관계 검증 (CRITICAL!)](#-기능-고장영향-인과관계-검증-critical)
2. [[TARGET] 기능의 이상 = 고장형태 (과/부족/유해 도출법)](#-기능의-이상--고장형태-과부족유해-도출법)
3. [필수 확장 규칙](#필수-확장-규칙-1nmk-구조)
4. [기능 개수 권장사항](#기능-개수-권장사항)
5. [항목 수 계산 예시](#항목-수-계산-예시)
6. [과도한 1:1 구조 경고](#-경고-과도한-11-선형-구조)
7. [AIAG-VDA 표준 근거](#aiag-vda-표준-근거)
8. [추가 CRITICAL 규칙](#추가-critical-규칙)

---

## [!!] 기능-고장영향 인과관계 검증 (CRITICAL!)

### 핵심 원칙

**기능이 실패하면 해당 고장영향이 실제로 발생하는가?**

```
[!] 가장 중요한 검증! 이 검증 없이 생성하면 논리적 오류 발생!

검증 순서:
기능 → 고장영향 → 고장형태 → 고장원인
  ↑        ↑           ↑          ↑
 1순위    2순위       3순위      4순위
(이것!)  (기존)      (기존)     (기존)
```

### 기능 동사 → 허용 고장영향 매핑

| 기능 동사 | 기능 실패 의미 | 허용 고장영향 | 금지 고장영향 |
|----------|--------------|--------------|--------------|
| **최소화한다** | 최소화 실패 = 증가 | 증가, 상승, 초과 | 소음, 외관, 접지 |
| **전달한다** | 전달 실패 = 불가/저하 | 변환 불가, 전달 불량, 저하 | 외관, 접지, 누유 |
| **제공한다** | 제공 실패 = 불가/저하 | 변환 불가, 전달 불량, 저하 | 외관, 접지, 다점접지, 조립 |
| **고정한다** | 고정 실패 = 이완/이동 | 이완, 이동, 변위, 탈락 | 효율, 손실, 절연 |
| **절연한다** | 절연 실패 = 파괴/단락 | 절연파괴, 단락, 누전, 지락 | 진동, 소음, 외관 |
| **지지한다** | 지지 실패 = 변형/붕괴 | 변형, 좌굴, 붕괴, 처짐 | 효율, 손실, 절연, 소음 |
| **냉각한다** | 냉각 실패 = 과열 | 과열, 온도상승, 열화 | 외관, 소음, 접지 |
| **밀봉한다** | 밀봉 실패 = 누출 | 누유, 누기, 침수 | 효율, 진동, 소음 |
| **접지한다** | 접지 실패 = 접지불량 | 다점접지, 접지불량, 순환전류 | 외관, 효율, 진동 |
| **변환한다** | 변환 실패 = 변환불량 | 전압변환 불량, 비율오차, 왜곡 | 외관, 접지, 조립 |
| **억제한다** | 억제 실패 = 증가 | 진동증가, 소음증가, 발열증가 | 외관, 접지, 누유 |
| **유지한다** | 유지 실패 = 변동/이탈 | 변동, 이탈, 불안정, 열화 | 외관, 접지, 조립 |
| **방출한다** | 방출 실패 = 축적 | 열축적, 가스축적, 압력증가 | 외관, 접지, 효율 |
| **연결한다** | 연결 실패 = 단절/불량 | 단절, 접촉불량, 저항증가 | 외관, 소음, 진동 |
| **분산한다** | 분산 실패 = 집중 | 국부과열, 응력집중, 전류집중 | 외관, 접지, 조립 |
| **흡수한다** | 흡수 실패 = 전달 | 충격전달, 진동전달, 열전달 | 외관, 접지, 효율 |
| **확보한다** | 확보 실패 = 부족 | 간극부족, 공간부족, 여유부족 | 외관, 접지, 조립 |
| **차단한다** | 차단 실패 = 통과 | 누설, 관통, 침투, 통과 | 외관, 소음, 진동 |
| **제한한다** | 제한 실패 = 초과 | 과전류, 과전압, 과온도 | 외관, 접지, 조립 |
| **방지한다** | 방지 실패 = 발생 | 부식발생, 산화발생, 마모발생 | 외관, 접지, 효율 |
| **보호한다** | 보호 실패 = 노출/손상 | 노출, 손상, 파손, 열화 | 외관, 접지, 조립 |

### [X] 잘못된 연결 예시 (실제 오류)

```
기능: "손실을 최소화한다"
  ├─ [X] 소음 기준 초과 → 손실과 소음은 인과관계 없음!
  ├─ [X] 외관 불합격   → 손실과 외관은 인과관계 없음!
  └─ [OK] 효율 저하     → 손실 증가 = 효율 저하 (맞음)

기능: "자속 경로를 제공한다"
  ├─ [X] 다점접지      → 자속 경로와 접지는 별개 기능!
  └─ [OK] 전압 변환 불량 → 자속 경로 문제 = 변환 불량 (맞음)
```

### [OK] 올바른 연결 예시

```
기능: "손실을 최소화한다" (동사: 최소화)
  └─ 기능 실패 = 손실 증가
     ├─ [OK] 효율 저하 (손실↑ → 효율↓)
     ├─ [OK] 무부하손실 기준 초과 (손실↑ → 기준 초과)
     └─ [OK] 온도 상승 (손실↑ → 발열↑ → 온도↑)

기능: "진동을 억제한다" (동사: 억제)
  └─ 기능 실패 = 진동 증가
     ├─ [OK] 소음 기준 초과 (진동↑ → 소음↑)
     ├─ [OK] 체결부 이완 (진동↑ → 피로 → 이완)
     └─ [OK] 권선 마모 (진동↑ → 접촉 → 마모)
```

### 검증 질문 (생성 전 필수!)

각 기능-고장영향 연결에 대해:

1. **"[기능]이 실패하면 [고장영향]이 발생하는가?"**
2. **"[기능 동사]의 반대가 [고장영향]과 일치하는가?"**
3. **"다른 기능의 고장영향은 아닌가?"**

```
예시 검증:
Q: "손실을 최소화한다"가 실패하면 "소음 기준 초과"가 발생하는가?
A: 아니오. 손실 증가 ≠ 소음 증가. 별개 현상.
   → 이 연결은 잘못됨! 제거 필요.

Q: "진동을 억제한다"가 실패하면 "소음 기준 초과"가 발생하는가?
A: 예. 진동 증가 → 소음 증가.
   → 이 연결은 올바름!
```

### 누락된 기능 발견 시

잘못된 연결을 발견하면, **새로운 기능을 추가**해야 할 수 있음:

```
문제: "손실 최소화" 기능에 "소음 기준 초과" 연결됨
해결: 새 기능 "진동을 억제한다" 추가

수정 전:
  손실을 최소화한다 → 소음 기준 초과 [X]

수정 후:
  손실을 최소화한다 → 효율 저하 [OK]
  진동을 억제한다 → 소음 기준 초과 [OK] (새 기능!)
```

---

## [TARGET] 기능의 이상 = 고장형태 (과/부족/유해 도출법)

> **기준**: 회의 합의 260109 (임채익 이사 피드백)
> **참조**: [5why-vs-fmea.md](5why-vs-fmea.md), [function-analysis.md](function-analysis.md)

### 핵심 원칙

**FMEA는 기능에서 시작하여 고장형태를 도출한다!** (5 Why와 반대)

```
[X] 5 Why 방식 (FMEA에서 금지!)
   문제(영향) → 형태 → 원인 (Reactive, 사후 대응)

[OK] FMEA 방식 (올바른 접근)
   기능 → 기능이상(과/부족/유해) → 고장형태 (Proactive, 사전 예방)
```

### 과/부족/유해 분류 체계

| 분류 | 영문 | 의미 | 질문 (가이드 V1.3) |
|------|------|------|------|
| **부족 (Under)** | Under-performance | 결과물 미달, 불완전 | "기능 결과물이 부족하면?" |
| **과 (Over)** | Over-performance | 결과물 초과 | "기능 결과물이 과하면?" |
| **유해 (Harmful)** | Harmful side-effect | 결과물 정상, 부작용 | "기능 결과물 정상인데 부작용?" |

### 도출 템플릿 (필수!)

**각 기능에 대해 3가지 질문을 반드시 수행:**

```
기능: [동사] + [대상/목적]
기능 결과물: [결과물] (예: 자속을 전달한다 → 전달된 자속)

├─ 부족: [기능 결과물]이 부족하면?
│   └─ 고장형태: [부족으로 인한 현상]
│
├─ 과: [기능 결과물]이 과하면?
│   └─ 고장형태: [과도로 인한 현상] (또는 해당 없음)
│
└─ 유해: [기능 결과물] 정상인데 부작용?
    └─ 고장형태: [부작용으로 인한 현상]
```

### 적용 예시

#### 예시 1: 볼트 (결합 기능)

```
기능: 구조물을 결합한다

├─ 부족: 결합 부족
│   └─ 고장형태: 풀림, 이완, 탈락, 누락
│
├─ 과: 결합 과도
│   └─ 고장형태: 손상, 파손, 변형, 나사산 손상
│
└─ 유해: 결합 시 부작용
    └─ 고장형태: 부식, 갈바닉 부식, 전기적 간섭
```

#### 예시 2: 절연물 (전기적 분리 기능)

```
기능: 전기적 분리를 유지한다

├─ 부족: 전기적 분리 부족
│   └─ 고장형태: 절연 저하, 누설 전류, 개방
│
├─ 과: 전기적 분리 과도
│   └─ 고장형태: (일반적으로 해당 없음)
│
└─ 유해: 전기적 분리 시 부작용
    └─ 고장형태: 절연 열화, 부분방전, 오염
```

#### 예시 3: 철심 (자속 전달 기능)

```
기능: 자속을 전달한다

├─ 부족: 자속 전달 부족
│   └─ 고장형태: 자속 밀도 저하, 적층 이완
│
├─ 과: 자속 전달 과도
│   └─ 고장형태: 자기포화, 과열
│
└─ 유해: 자속 전달 시 부작용
    └─ 고장형태: 와전류 발생, 진동 유발
    [!] 주의: "진동"은 C열(고장영향)으로, E열에는 진동을 유발하는 형태 기술
```

### 자가 검증 체크리스트

- [ ] 각 기능에 대해 과/부족/유해 3가지 분석을 수행했는가?
- [ ] 고장형태가 기능 이상에서 논리적으로 도출되었는가?
- [ ] "해당 없음"인 경우 명시적으로 표기했는가?
- [ ] 고장형태(E열)에 미래 영향(소음, 진동)이 포함되지 않았는가?

---

## 필수 확장 규칙 (1:N:M:K 구조)

**각 레벨에서 WebSearch 기반 항목 식별** (AIAG-VDA 2019):
- [OK] **1개 기능 → N개 고장영향** (WebSearch에서 발견된 영향)
- [OK] **1개 고장영향 → N개 고장형태** (WebSearch에서 발견된 고장 형태)
- [OK] **1개 고장형태 → N개 고장원인** (WebSearch에서 발견된 근본 원인)
- [!] **핵심**: 억지로 개수를 맞추지 말고 WebSearch 결과에 따라 자연스럽게 구성

---

## 기능 개수 권장사항

**WebSearch 기반 기능 식별**:
- WebSearch에서 발견된 주요 기능 사용
- 억지로 기능 개수를 맞추지 않음
- 부품 복잡도에 따라 자연스럽게 결정

---

## 항목 수 계산 예시

**기능별 확장** (평균 기준):
- 3 기능 × 평균 2 영향 × 평균 2.5 모드 × 평균 2.5 원인 ≈ 37개 항목
- 5 기능 × 평균 2 영향 × 평균 3 모드 × 평균 3 원인 ≈ 90개 항목

**주의**: 일부 기능은 1개 고장영향만 가질 수 있으나, 전체 평균이 1.5개 이상이 되도록 유지

---

## [BLOCKING] 형태당 원인 수 요구사항 (GATE 4)

> **재발방지대책 260201**: UPPER_PRESSURE FMEA 6회 수정 후 원인 분석
> validate_diamond_preview() 함수로 GATE 3에서 조기 발견 가능

### 핵심 규칙

**고장형태(E열) 1개당 고장원인(F열) >= 2개 필수!**

```
[BLOCKING] generate_fmea_excel.py GATE 4에서 검증
- 형태당 원인 평균 < 2.0 -> Excel 생성 BLOCKING!
- 원인: 같은 고장형태에 대해 서로 다른 원인이 필요
```

### 항목 수 계산 가이드

| 목표 형태 수 | 필요 원인 수/형태 | 총 항목 수 | 예시 |
|-------------|-----------------|-----------|------|
| 15개 | 2개 | **30개** | 최소 권장 |
| 15개 | 3개 | **45개** | 중간 |
| 20개 | 3개 | **60개** | 충분 |

### 실패 사례 (UPPER_PRESSURE)

```
[X] 1차 시도 (30개 항목, 30개 형태, 원인 1.00개/형태)
   - 각 형태마다 원인 1개씩만 -> 다이아몬드 실패!
   - 30개 항목 = 30개 형태 x 1개 원인 (BLOCKING)

[OK] 수정 후 (60개 항목, 30개 형태, 원인 2.00개/형태)
   - 각 형태마다 원인 2개씩 -> 다이아몬드 통과!
   - 60개 항목 = 30개 형태 x 2개 원인 (PASS)
```

### 올바른 구조 예시

```
고장형태: "부족: 적층이완" (1개 형태)
  ├─ 고장원인 1: "제작: 클램프 체결력 부족 (작업자 숙련도)"
  │   └─ H/J열: 해당 원인에 맞는 예방/검출대책
  └─ 고장원인 2: "재료: 클램프 자재 불량 (수입검사 누락)"
      └─ H/J열: 해당 원인에 맞는 예방/검출대책

-> 2개 원인 = 2개 행 (서로 다른 H/J열 내용!)
```

### 잘못된 구조 예시

```
[X] 같은 원인을 반복 (위반!)
   형태: "부족: 적층이완"
     ├─ 원인 1: "제작: 클램프 체결력 부족"
     └─ 원인 2: "제작: 클램프 체결력 부족" <- 동일! (H~T열 repeat error)

[X] 유사한 원인 (위반!)
   형태: "부족: 적층이완"
     ├─ 원인 1: "제작: 체결력 부족"
     └─ 원인 2: "제작: 체결력 미흡" <- 사실상 동일!
```

### 다른 원인 도출 방법

1. **라이프사이클 다양화**: 설계/재료/제작/시험 중 다른 단계
2. **근본원인 다양화**: 작업자/장비/자재/환경/방법 등
3. **WebSearch 활용**: 실제 고장 사례에서 원인 찾기

---

## [X] 경고: 과도한 1:1 선형 구조

### 잘못된 예 (모든 기능이 1:1 구조)

**위험 시나리오 대부분 누락**:
```
기능A → 영향1 → 모드1 → 원인1
기능B → 영향2 → 모드2 → 원인2
기능C → 영향3 → 모드3 → 원인3
...
기능J → 영향10 → 모드10 → 원인10

문제: 10개 기능 모두 1개 고장영향만 보유 (100% 1:1 구조)
     → 통계적으로 불가능, 위험 시나리오 대부분 누락
```

### 허용 가능한 예 (일부 기능만 1:1)

```
기능A → 영향1, 영향2 (2개) [OK]
기능B → 영향3 (1개만) [OK] - 실제로 1개만 존재 가능
기능C → 영향4, 영향5, 영향6 (3개) [OK]
기능D → 영향7 (1개만) [OK]
기능E → 영향8, 영향9 (2개) [OK]

결과: 5개 기능 중 2개만 1:1 (40%) → 허용 가능
      평균: 9개 영향 / 5개 기능 = 1.8개/기능 [OK]
```

### 올바른 예 (다이아몬드 확장)

```
기능A → 영향1, 영향2 (2개)
  영향1 → 형태1("층간단락"), 형태2("과열"), 형태3("변형") (3개)
    형태1 → 원인1, 원인2, 원인3 (3개)
    형태2 → 원인4, 원인5 (2개)
    형태3 → 원인6, 원인7, 원인8 (3개)
  영향2 → 형태4("부식"), 형태5("균열") (2개)
    형태4 → 원인9, 원인10 (2개)
    ...
결과: 1개 기능 → 2개 영향 → 각 2-3개 모드 → 각 2-3개 원인
```

---

## AIAG-VDA 표준 근거

**fmea-concepts.md 참조**:
- "1개 기능 → N개 고장영향" (기능 실패 시 상위 시스템에 미치는 **모든** 영향)
- "각 레벨에서 가능한 **모든 항목을 식별** (N개씩)"
- "1:1:1 매칭은 대부분의 위험 시나리오 누락"

### 핵심 해석

**표준은 "최소 N개"를 요구하지 않고, "가능한 모든 항목 식별"을 요구**:
- 일부 기능은 1개 고장영향만 가질 수 있음 (실제로 1개만 존재하는 경우)
- 하지만 모든 기능이 1개씩만 갖는 건 통계적으로 불가능 (위험 시나리오 누락)

### 실무 예시

**절연 관련 기능** (1개 영향 허용):
- "절연 유지" 기능 → "절연 파괴" 영향 (1개만) [OK]
- "밀봉 유지" 기능 → "누유 발생" 영향 (1개만) [OK]

**일반적인 기능** (2개 이상 영향):
- "자속 전달" 기능 → "전압 변환 불가", "권선 소손", "철심 과열" (3개) [OK]
- "기계적 지지" 기능 → "변형", "진동 소음", "재료 열화" (3개) [OK]

---

## 추가 CRITICAL 규칙

### 1. 고장형태 다양화

같은 형태 반복 금지! 구체적 현상으로 다양하게:
- 층간단락
- 과열
- 변형
- 부식
- 균열
- 누유
- 진동
- 절연열화

### 2. 독립적 조합

각 Effect-Mode-Cause 조합은 서로 다른 위험을 나타냄:
- 같은 영향이라도 다른 모드로 발생 가능
- 같은 모드라도 다른 원인으로 발생 가능

### 3. 단계별 생성

**올바른 생성 순서**:
1. Function 식별 (부품이 수행하는 모든 기능)
2. 각 Function → 모든 Effect 나열 (기능 실패 시 모든 영향)
3. 각 Effect → 모든 Mode 나열 (영향을 일으키는 모든 고장 형태)
4. 각 Mode → 모든 Cause 나열 (모드를 발생시키는 모든 근본 원인)

---

## [BLOCKING] 기능 커버리지 계획 (v12.1 강화)

> **재발방지대책 260208**: 지지철 FMEA에서 주기능 F1 "지지목을 고정한다" 전체 누락
> **v12.1**: 다이어그램 모든 기능 = 각 최소 2개 항목! + 내부문서/WebSearch 추가 기능 확장

### 핵심 규칙

**다이어그램의 모든 기능(주기능+보조기능)이 각각 최소 2개 항목으로 포함! (BLOCKING!)**
**내부문서/WebSearch에서 발굴한 추가 기능도 각 1개 이상 포함!**
**주기능은 전체 항목의 >= 30%를 차지해야 함! (WARNING)**

```
function_coverage_plan 구조 (v12.1):
{
  "F1_주기능명": {"type": "주기능", "min_items": N, "source": "다이어그램"},
  "F2_보조기능명": {"type": "보조기능", "min_items": 2, "source": "다이어그램"},
  "F3_추가기능명": {"type": "추가기능", "min_items": 1, "source": "내부문서"},
  ...
}

규칙 (v12.1):
- 다이어그램 기능 (주기능+보조기능 전부):
  -> 주기능 min_items = max(2, 전체_목표의 30%)
  -> 보조기능 min_items = 각 2개 이상! (1개 = 불충분!)
  -> 0개 기능 = BLOCKING FAIL!
- 추가 기능 (내부문서/WebSearch 발굴):
  -> min_items = 각 1개 이상
- Generator Worker에 plan + source 정보 전달 -> 누락 방지
- Phase 2 완료 후 GATE에서 커버리지 검증
```

### 실패 사례 (지지철 v12)

```
[X] F1 "지지목을 고정한다" = 0개 항목 (전체 누락!)
    F2 "접속선의 위치를 유지한다" = 6개 항목
    F3 "절연 간격을 확보한다" = 8개 항목
    -> 주기능 비율 0% (기준: >= 30%)

원인: 보조기능 F2/F3가 더 다양한 고장영향을 가져
      Generator가 주기능 F1을 의미적으로 흡수/생략
```

### 올바른 구조 (v12.1 기준)

```
[OK] F1 "지지목을 고정한다" = 5개 항목 (31.3%) [다이어그램-필수]
     F2 "접속선의 위치를 유지한다" = 4개 항목 [다이어그램-필수]
     F3 "절연 간격을 확보한다" = 4개 항목 [다이어그램-필수]
     F4 "진동을 흡수한다" = 3개 항목 [내부문서-추가]
     -> 다이어그램 기능 3/3 전부 포함, 각 2개+ [O]
     -> 추가기능 1개, 1개+ [O]
     -> 주기능 비율 31.3% (>= 30%) [O]
```

---

## 품질 검증 체크리스트

### 기능 커버리지 검증 (v12.1)
- [ ] 다이어그램 모든 기능이 각 2개+ 항목?
- [ ] 추가기능(내부문서/WebSearch)이 각 1개+ 항목?
- [ ] 주기능 비율 >= 30%?
- [ ] function_coverage_plan에 source 정보(다이어그램/내부문서/WebSearch) 포함?
- [ ] function_coverage_plan이 research_data에 포함?

### 다이아몬드 구조 검증
- [ ] Failure Chain 논리적 연결? (기능->형태->영향, 원인은 형태에서 도출)
- [ ] WebSearch에서 발견된 항목만 사용?

### 고장형태 다양성 검증
- [ ] 구체적 고장형태 (층간단락, 과열, 변형 등) 사용?
- [ ] 추상적 표현 (부족, 저하) 금지?

### 전체 검증
- [ ] 라이프사이클 4단계로 분류? (비율 강제 아님)
- [ ] WebSearch 5개 출처 모두 참조?
- [ ] S/O/D WebSearch 근거 있음?

---

**참고**: AIAG-VDA 2019 표준 및 fmea-concepts.md 기반
